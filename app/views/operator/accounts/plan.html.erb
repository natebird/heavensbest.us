<% if @subscription && @subscription.errors.any? %>
  <div class="errorExplanation">
    <h2>Errors encountered with your change:</h2>
    <ul>
      <%= @subscription.errors.full_messages.map {|m| content_tag('li', m)} %>
    </ul>
  </div>
<% end %>

<div id="content">
	<h1><%= @page_title = "Subscription Information for #{h(@account.name)}" %></h1>

<div class='left' style="width: 400px">
	<p> You can change your subscription plan at any time. New plan features will be available immediately, 
		but your bill amount will not change until your next bill date.</p>

	<label>Card ends with xxxx</label>
	<%= link_to "Change", billing_path %>
	
	<% form_tag plan_operator_account_url do %>
	    <label>Subscription</label>
		<%= select_tag(nil, options_for_select([[nil]] + SubscriptionPlan.to_dropdown, 
			@subscription.subscription_plan.id), {:onchange => "enableButton();"} ) %>

		<!-- <label>Account Balance</label>
		$xx.xx -->

		<label>Next Billing Date</label>
		<%= @subscription.next_renewal_at.to_s(:short_day) %>
	
		<br />	<br />
		<%= link_to(image_tag("/images/buttons/cancel_plan.gif"), cancel_path ) %>
		<%= link_to(image_tag("/images/buttons/back.gif"), :back) %>
		<%= image_submit_tag("/images/buttons/change_plan.gif", :class => 'button', :disabled => true) %>
	
		<br /><br />
		<p>	Refunds will not be issued for canceled subscriptions. 
		   	Any remaining balance will be saved until the subscription is reactivated. 
			View the <% link_to "Terms of Service", page_path('tos') %>
			or email <%= mail_to "billing@heavensbest.us", "billing@heavensbest.us", :encode => :hex, 
			:subject => "Question about the policies" %> with questions.</p>
  
	<% end %>
</div>

	<div id="plans"><%= render :partial => "plans" %></div>
<div class="clearfix"></div>
</div>

<script type="text/javascript" charset="utf-8">
  function enableButton() {
    document.getElementById('commit').disabled = document.forms[0].elements['plan_id'].selectedIndex == 0
  }
  enableButton();
</script>
